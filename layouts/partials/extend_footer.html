{{- /* Footer custom content area start */ -}}
{{- /*     Insert any custom code web-analytics, resources, etc. here */ -}}
{{- /* Footer custom content area end */ -}}
<script>
  (function () {
    var toc = document.querySelector('.post-modern > .toc');
    if (!toc) return;
    var links = toc.querySelectorAll('a[href^="#"]');
    var map = [];
    links.forEach(function (a) {
      var id = decodeURIComponent(a.getAttribute('href').slice(1));
      var el = document.getElementById(id);
      if (el) map.push({ a: a, el: el });
    });
    var active;
    var io = new IntersectionObserver(function (entries) {
      entries.forEach(function (e) {
        if (!e.isIntersecting) return;
        var id = e.target.id;
        var item = map.find(function (m) { return m.el.id === id; });
        if (!item) return;
        if (active) active.classList.remove('active');
        item.a.classList.add('active');
        active = item.a;
      });
    }, { rootMargin: '0px 0px -70% 0px', threshold: [0, 1] });
    map.forEach(function (m) { io.observe(m.el); });
  })();
</script>

<script>
  (function () {
    function isMermaidDiagram(text) {
      if (!text) return false;
      var t = text.replace(/^\s+/, '');
      return /^(graph|flowchart|sequenceDiagram|gantt|classDiagram|stateDiagram|erDiagram|journey|gitGraph|pie|mindmap|timeline|quadrantChart|xychart-beta|packet)/.test(t);
    }

    function convertMermaidCodeBlocks() {
      var selectors = [
        'pre code.language-mermaid',
        'pre code[class*="language-mermaid"]',
        'pre code.language-fallback'
      ];
      var nodes = document.querySelectorAll(selectors.join(','));
      nodes.forEach(function (codeEl) {
        var text = codeEl.textContent || '';
        var isExplicit = codeEl.className && codeEl.className.indexOf('language-mermaid') !== -1;
        if (!isExplicit && !isMermaidDiagram(text)) return;
        var container = document.createElement('div');
        container.className = 'mermaid';
        container.textContent = text;
        var pre = codeEl.closest('pre');
        if (pre && pre.parentNode) pre.parentNode.replaceChild(container, pre);
      });
    }

    function initMermaid() {
      if (window.mermaid) {
        try {
          window.mermaid.initialize({ startOnLoad: true, securityLevel: 'loose' });
        } catch (e) {}
      }
    }

    function run() {
      convertMermaidCodeBlocks();
      initMermaid();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', run);
    } else {
      run();
    }
  })();
</script>
